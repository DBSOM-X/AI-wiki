**NOTE:** This guide is still in alpha and is probably missing a few things and / or contains mistakes

# Installing ESRGAN on Arch Linux based Distros for Nvidia Users

This guide will lead you through installing `ESRGAN`, `SFTGAN`, `BasicSR` and `Deorder's` scripts on Linux.

For this guide I assume that you have Your Arch Distro set up with base, base-devel, and yay (AUR wrapper). If you don't have yay installed, [here is the first guide I found with duckduckgo for installing yay.](https://ebblr.com/how-to-install-yay-on-arch-linux/)

## Section 1: Dependencies Preparation

In this section we will prepare the directories we want to work in and install all dependencies as well as Deorder's scripts, BasicSR, ESRGAN, SFTGAN.

1. Open a Terminal and navigate to where you want to put the project directory. In my case `/home/combi/code/git`
2. Install the requirements:

   ```bash
   yay -S nvidia cuda cudnn python-pytorch-cuda python-torchvision lmdb python-lmdb opencv-cuda python-tensorboardx imagemagick
   ```

   > **Note:** If you use a distro not based on arch, you must install the equivalent packages with your package manager.

3. Clone the `neural-testing-scripts` repo:

   ```bash
   git clone https://github.com/gameupscale/neural-testing-scripts.git
   ```

4. Clone `neural-training-scripts` repo

   ```bash
   git clone https://github.com/gameupscale/neural-training-scripts.git
   ```

5. Go into the newly created Directory:

   ```bash
   cd neural-testing-scripts
   ```

6. Clone the `BasicSR` repo

   ```bash
   git clone https://github.com/xinntao/BasicSR.git
   ```

7. Clone the `ESRGAN` repo

   ```bash
   git clone https://github.com/xinntao/ESRGAN.git
   ```

8. Clone the `SFTGAN` repo

   ```bash
   git clone https://github.com/xinntao/SFTGAN.git
   ```

And that was the installation.

## Section 2: Using Deorder's scripts to process images with ESRGAN

> **Note:** This will only work correctly for power of 2 sized textures at the moment.

> **Note:** When `.` is mentioned before a path, it means in the current directory.

### Steps when you want to use ESRGAN

1. Put all the images or textures you want to process inside the `./input` directory.

2. Split Alpha and RGB as will as cut the images into tiles:

   ```bash
   bash create_tiles.sh -i="./input" -d=16 -h=256 -w=256 -o="./ESRGAN/LR"
   ```

   #### The Options for the command:

   > **Note:** Don't change the `output-dir` unless you want to use BasicSR or another Neural Network instead of ESRGAN.

   `-d=` The Overdraw

   `-h=` and `-w=` the tile size. (

    > **Note:** Overdraw may be added on all sites on the tile, so in the example the tiles can be up to 288x288)

   `-i=` the input directory

   `-o=` the output directory

3. Set the scale in `test.py`:

   ```bash
   sed -i -e "s/upscale=[0-9]*/upscale=${SCALE}/g" ./esrgan/test.py
   ```

   > **Note:** Replace `${SCALE}` with the scale of the model you wish to use.

   > **Example for 1x models:** `sed -i -e "s/upscale=[0-9]*/upscale=1/g" ./esrgan/test.py`

4. Run ESRGAN

   ```bash
   pushd ./ESRGAN/; python test.py ./models/<TheModelYouWanToUse>.pth; popd
   ```

   > **Note:** Replace `<TheModelYouWanToUse>` with the model you want to use.

5. Recombine the images:

   ```bash
   bash assemble_tiles.sh -i="./ESRGAN/results" -o="./output" -d=64 -p="_rlt"
   ```

   #### The Options for the command:

   > **Note:** Don't change the output dir unless you want to use BasicSR or another Neural Network instead of ESRGAN.

   `-d=` The Overdraw

   > **Note:** The Overdraw must be `model scale` * `Overdraw from step 2`

   > **Example for Scale 1 with default values** = 16

   > **Example for Scale 2 with default values** = 32

   > **Example for Scale 4 with default values** = 64

   > **Example for Scale 8 with default values** = 128

   `-p=` the postfix of the images generated by ESRGAN

   > **Note:** When you run ESRGAN it adds `_rlt` by default to the original name, if the postfix is different then change it, if there is no postfix change it to `-p=""`

   `-i=` the input directory

   `-o=` the output directory

6. That's it, the output should appear in `output` (if you didn't change it).

## Training ESRGAN

## Credits

The scripts used in this guide were written by [Deorder](https://github.com/deorder).
